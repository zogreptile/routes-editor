{"version":3,"sources":["components/SearchBar.js","constants/index.js","components/PlaceItem.js","components/PlacesList.js","components/Route.js","components/App.js","index.js"],"names":["SearchBar","_this$props","this","props","value","onChange","onSubmit","react_default","a","createElement","className","type","placeholder","React","PureComponent","mapState","center","zoom","ItemTypes","DropTarget","drop","monitor","component","dragIndex","getItem","index","dropIndex","onDrop","connect","connectDropTarget","dropTarget","isHovering","isOver","DragSource","beginDrag","id","connectDragSource","dragSource","isDragging","_ref","caption","onRemove","style","opacity","color","onClick","PlacesList","points","onRemoveItem","onDropItem","length","map","el","ind","components_PlaceItem","key","Route","onChangeLocation","routeCoords","point","coords","Fragment","react_yandex_maps_umd_production_min","geometry","properties","iconContent","balloonContent","options","draggable","iconColor","modules","onDragEnd","e","newCoords","originalEvent","target","getCoordinates","App","state","searchValue","ymaps","setMapRef","console","log","_this","setState","setYmapsRef","handleSearchChange","handleSearchSubmit","_callee","_this$state","geocodeResponse","geocodedPoint","newPoint","regenerator_default","wrap","_context","prev","next","preventDefault","abrupt","geocode","results","sent","geoObjects","get","nanoid","setCenter","concat","Object","toConsumableArray","t0","stop","handleItemRemove","_this$state2","newPoints","filter","handleItemDrop","dragItem","dropItem","handlePointChangeLocation","_callee2","_this$state3","updatedPoints","_context2","reduce","acc","updatedPoint","objectSpread","getAddressLine","_this$state4","components_SearchBar","components_PlacesList","defaultState","width","height","onLoad","instanceRef","components_Route","Component","ReactDOM","render","lib","backend","HTML5Backend","query","load","apikey","components_App","document","getElementById"],"mappings":"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","file":"static/js/main.94da18d3.chunk.js","sourcesContent":["import React from 'react';\n\nclass SearchBar extends React.PureComponent {\n  render() {\n    const {\n      value,\n      onChange,\n      onSubmit,\n    } = this.props;\n\n    return (\n      <form\n        className='search-bar'\n        onSubmit={onSubmit}\n      >\n        <input\n          className='search-bar__input'\n          type='text'\n          placeholder='Введите адрес'\n          value={value}\n          onChange={onChange}\n        />\n      </form>\n    );\n  }\n};\n\nexport default SearchBar;","export const mapState = {\n  center: [55.75, 37.57],\n  zoom: 14,\n};\n\nexport const ymapQuery = {\n  load: 'geocode',\n  apikey: 'eeb0c9a9-72eb-497b-a566-b040ed89c6c1',\n};\n\nexport const ItemTypes = {\n  LIST_ITEM: 'listItem',\n};\n","import React from 'react';\nimport {\n  DragSource,\n  DropTarget,\n} from 'react-dnd';\nimport { ItemTypes } from '../constants';\n\nconst itemSource = {\n  beginDrag(props) {\n    return {\n      id: props.id,\n      index: props.index,\n    };\n  }\n};\n\nconst collectSource = (connect, monitor) => {\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  }\n};\n\nconst itemTarget = {\n  drop(props, monitor, component) {\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t};\n\t\tconst dragIndex = monitor.getItem().index;\n\t\tconst dropIndex = props.index;\n\n\t\tif (dragIndex === dropIndex) {\n\t\t\treturn;\n\t\t};\n\n\t\tprops.onDrop(dragIndex, dropIndex);\n\t\tmonitor.getItem().index = dropIndex;\n  },\n};\n\nconst collectTarget = (connect, monitor) => ({\n  connectDropTarget: connect.dropTarget(),\n  isHovering: monitor.isOver(),\n})\n\nconst PlaceItem = ({\n  connectDragSource,\n  connectDropTarget,\n  isDragging,\n  isHovering,\n  caption,\n  onRemove,\n}) => connectDragSource(connectDropTarget(\n  <li\n    className='places__item'\n    style={{\n      opacity: isDragging ? 0 : 1,\n      color: isHovering && !isDragging ? '#3589eb' : 'inherit',\n    }}\n  >\n    {caption}\n    <button\n      className='places__item-remove'\n      onClick={onRemove}\n    >\n      ✕\n    </button>\n  </li>\n));\n\nexport default DropTarget(\n  ItemTypes.LIST_ITEM,\n  itemTarget,\n  collectTarget\n)(DragSource(\n  ItemTypes.LIST_ITEM,\n  itemSource,\n  collectSource\n)(PlaceItem));\n","import React from 'react';\nimport PlaceItem from './PlaceItem';\n\nclass PlacesList extends React.PureComponent {\n  render() {\n    const {\n      points,\n      onRemoveItem,\n      onDropItem,\n    } = this.props;\n\n    if (!points.length) {\n      return null;\n    }\n\n    return (\n      <ul className='places'>\n        {points.map((el, ind) =>\n          <PlaceItem\n            key={el.id}\n            id={el.id}\n            index={ind}\n            caption={el.caption}\n            onRemove={() => onRemoveItem(el.id)}\n            onDrop={onDropItem}\n          />\n        )}\n      </ul>\n    );\n  };\n};\n\nexport default PlacesList;\n","import React from 'react';\nimport {\n  Placemark,\n  Polyline,\n} from 'react-yandex-maps';\n\nclass Route extends React.PureComponent {\n  render() {\n    const {\n      points,\n      onChangeLocation,\n    } = this.props;\n\n    if (!points.length) {\n      return null;\n    }\n\n    const routeCoords = points.map(point => point.coords);\n\n    return (\n      <>\n        <Polyline geometry={routeCoords} />\n        {\n          points.map((point, index) =>\n            <Placemark\n              key={point.id}\n              geometry={point.coords}\n              properties={{\n                iconContent: index + 1,\n                balloonContent: point.balloonContent,\n              }}\n              options={{\n                draggable: true,\n                iconColor: '#ff0000',\n              }}\n              modules={['geoObject.addon.balloon']}\n              onDragEnd={(e) => {\n                const newCoords = e.originalEvent.target.geometry.getCoordinates();\n                onChangeLocation(point.id, newCoords);\n              }}\n            />\n          )\n        }\n      </>\n    );\n  };\n};\n\nexport default Route;\n","import React from 'react';\nimport { Map } from 'react-yandex-maps';\nimport nanoid from 'nanoid';\nimport SearchBar from './SearchBar';\nimport PlacesList from './PlacesList';\nimport Route from './Route';\nimport { mapState } from '../constants';\nimport '../App.css';\n\nclass App extends React.Component {\n  state = {\n    searchValue: '',\n    points: [],\n    ymaps: null,\n    map: null,\n  }\n\n  setMapRef = (map) => {\n    console.log('MAP_REF_SET');\n    this.setState({ map });\n  }\n\n  setYmapsRef = (ymaps) => {\n    this.setState({ ymaps });\n  }\n\n  handleSearchChange = (e) => {\n    this.setState({ searchValue: e.target.value });\n  }\n\n  handleSearchSubmit = async (e) => {\n    e.preventDefault();\n    const {\n      ymaps,\n      searchValue,\n      points,\n      map,\n    } = this.state;\n\n    if (!searchValue) {\n      return null;\n    }\n\n    try {\n      const geocodeResponse = await ymaps.geocode(searchValue, { results: 1 });\n      const geocodedPoint = geocodeResponse.geoObjects.get(0);\n      const newPoint = {\n        id: 'id_' + nanoid(),\n        coords: geocodedPoint.geometry.getCoordinates(),\n        caption: geocodedPoint.properties.get('text'),\n        balloonContent: geocodedPoint.properties.get('balloonContent'),\n      };\n  \n      map.setCenter(newPoint.coords);\n  \n      this.setState({\n        searchValue: '',\n        points: [...points, newPoint],\n      });\n    } catch (err) {\n      console.log('SEARCH_ERROR: ', err);\n    }\n\n  }\n\n  handleItemRemove = (id) => {\n    const {\n      points,\n      map,\n    } = this.state;\n\n    const newPoints = points.filter(point => point.id !== id);\n\n    //TODO: show all points\n    newPoints.length && map.setCenter(newPoints[newPoints.length - 1].coords);\n\n    this.setState({ points: newPoints });\n  }\n\n  handleItemDrop = (dragIndex, dropIndex) => {\n    const { points } = this.state;\n\n    const newPoints = [...points];\n    const dragItem = newPoints[dragIndex];\n    const dropItem = newPoints[dropIndex];\n    newPoints[dragIndex] = dropItem;\n    newPoints[dropIndex] = dragItem;\n\n    this.setState({ points: newPoints });\n  }\n\n  handlePointChangeLocation = async (id, coords) => {\n    const {\n      points,\n      ymaps,\n    } = this.state;\n\n    try {\n      const geocodeResponse = await ymaps.geocode(coords, { results: 1 });\n      const geocodedPoint = geocodeResponse.geoObjects.get(0);\n      const updatedPoints = points.reduce((acc, el) => {\n        if (el.id === id) {\n          const updatedPoint = {\n            ...el,\n            coords,\n            caption: geocodedPoint.getAddressLine(),\n            balloonContent: geocodedPoint.properties.get('balloonContent'),\n          };\n          return [...acc, updatedPoint];\n        }\n  \n        return [...acc, el];\n      }, []);\n  \n      this.setState({ points: updatedPoints });\n    } catch (err) {\n      console.log('CHANGE_LOCATION_ERROR: ', err);\n    }\n  }\n\n  render() {\n    const {\n      searchValue,\n      points,\n    } = this.state;\n\n    return (\n      <>\n        <SearchBar\n          value={searchValue}\n          onChange={this.handleSearchChange}\n          onSubmit={this.handleSearchSubmit}\n        />\n        <PlacesList\n          points={points}\n          onRemoveItem={this.handleItemRemove}\n          onDropItem={this.handleItemDrop}\n        />\n        <Map\n          defaultState={mapState}\n          width='100%'\n          height='100vh'\n          onLoad={this.setYmapsRef}\n          instanceRef={this.setMapRef}\n        >\n          <Route\n            points={points}\n            onChangeLocation={this.handlePointChangeLocation}\n          />\n        </Map>\n      </>\n    );\n  }\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { DragDropContextProvider } from 'react-dnd';\nimport HTML5Backend from 'react-dnd-html5-backend';\nimport { YMaps } from 'react-yandex-maps';\nimport App from './components/App';\nimport { ymapQuery } from './constants';\nimport './index.css';\n\nReactDOM.render(\n  <DragDropContextProvider backend={HTML5Backend}>\n    <YMaps query={ymapQuery}>\n      <App />\n    </YMaps>\n  </DragDropContextProvider>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}